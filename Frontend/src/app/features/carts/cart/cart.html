<div class="container py-4">
  @if (isLoading()) {
    <div class="d-flex justify-content-center align-items-center" style="min-height: 50vh;">
      <div class="text-center">
        <div class="spinner-border text-warning" role="status" style="width: 50px; height: 50px;">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3 fw-medium text-dark">Loading your cart...</p>
      </div>
    </div>
  }

  @if (!isLoading() && (!cart() || cart()!.items.length === 0)) {
    <div class="d-flex justify-content-center align-items-center" style="min-height: 50vh;">
      <div class="text-center p-5 bg-white bg-opacity-75 rounded-3 shadow-sm border border-white border-opacity-50" style="backdrop-filter: blur(10px);">
        <i class="bi bi-cart-x display-1 text-secondary mb-4"></i>
        <h2 class="fw-semibold text-dark mb-3">Your Shopping Cart is Empty</h2>
        <p class="text-secondary mb-4">Looks like you haven't added any items yet. Start shopping to fill your cart!</p>
        <a href="/products" class="btn btn-warning btn-lg px-4">
          <i class="bi bi-shop me-2"></i>Continue Shopping
        </a>
      </div>
    </div>
  }

  @if (!isLoading() && cart() && cart()!.items.length > 0) {
    <div class="cart-content">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-semibold text-dark mb-0">
          <i class="bi bi-cart3 me-2"></i>Shopping Cart
          <span class="badge bg-light text-dark border ms-3 fs-6 fw-semibold">{{ totalItems() }} {{ totalItems() === 1 ? 'Item' : 'Items' }}</span>
        </h3>
      </div>

      <div class="row g-4">
        <div class="col-lg-8">
          <div class="d-flex flex-column gap-3">
            @for (item of cart()!.items; track item.id) {
              <div class="card border-0 shadow-sm bg-white bg-opacity-75 p-3" style="backdrop-filter: blur(10px); cursor: pointer; transition: all 0.2s ease;" (click)="navigateToProduct(item.productId)">
                <div class="row g-3 align-items-center">
                  <div class="col-auto">
                    <div class="rounded overflow-hidden bg-light" style="width: 80px; height: 80px;">
                      <img [src]="item.image_url" 
                           [alt]="item.productName"
                           onerror="this.src='/favicon.ico'"
                           class="w-100 h-100"
                           style="object-fit: cover;">
                    </div>
                  </div>
                  
                  <div class="col">
                    <h5 class="fw-semibold text-dark mb-2">{{ item.productName }}</h5>
                    <p class="mb-0">
                      <span class="text-secondary small">Price: </span>
                      <span class="text-warning fw-bold">{{ item.price | currency:'INR' }}</span>
                    </p>
                  </div>

                  <div class="col-auto text-center">
                    <label class="text-secondary small fw-medium d-block mb-2">Quantity</label>
                    <div class="btn-group" role="group">
                      <button class="btn btn-sm btn-outline-secondary" (click)="decrementQuantity(item, $event)">
                        <i class="bi bi-dash"></i>
                      </button>
                      <input type="number" 
                             class="form-control form-control-sm text-center fw-bold border-secondary" 
                             style="width: 50px;"
                             [value]="item.quantity" 
                             min="1" 
                             max="99"
                             (change)="updateQuantity(item, $event)">
                      <button class="btn btn-sm btn-outline-secondary" (click)="incrementQuantity(item, $event)">
                        <i class="bi bi-plus"></i>
                      </button>
                    </div>
                  </div>

                  <div class="col-auto text-center">
                    <label class="text-secondary small fw-medium d-block mb-2">Subtotal</label>
                    <div class="text-warning fw-bold fs-6">{{ item.totalPrice | currency:'INR' }}</div>
                  </div>

                  <div class="col-auto">
                    <button class="btn btn-sm btn-outline-danger rounded-circle" (click)="removeItem(item.id, $event)" title="Remove item" style="width: 36px; height: 36px;">
                      <i class="bi bi-trash3"></i>
                    </button>
                  </div>
                </div>
              </div>
            }
          </div>
        </div>

        <div class="col-lg-4">
          <div class="position-sticky" style="top: 20px;">
            <div class="card border-0 shadow-sm bg-white bg-opacity-75 p-4" style="backdrop-filter: blur(10px);">
              <h5 class="fw-semibold text-dark mb-3 pb-3 border-bottom">
                <i class="bi bi-receipt-cutoff me-2"></i>Order Summary
              </h5>

              <div class="mb-3">
                <div class="d-flex justify-content-between py-2 text-dark small">
                  <span>Subtotal ({{ totalItems() }} {{ totalItems() === 1 ? 'Item' : 'Items' }}):</span>
                  <span class="fw-semibold">{{ cart()!.totalPrice | currency:'INR' }}</span>
                </div>
                
                <div class="d-flex justify-content-between py-2 text-dark small">
                  <span>Shipping:</span>
                  <span class="text-success fw-semibold">FREE</span>
                </div>

                <div class="d-flex justify-content-between py-2 text-dark small">
                  <span>Tax (9%):</span>
                  <span class="fw-semibold">{{ cart()!.totalPrice * 0.09 | currency:'INR' }}</span>
                </div>

                <hr class="my-3">

                <div class="d-flex justify-content-between py-2 border-top pt-3">
                  <span class="fw-bold">Total:</span>
                  <span class="text-warning fw-bold fs-4">{{ cart()!.totalPrice * 1.09 | currency:'INR' }}</span>
                </div>
              </div>

              <div class="d-grid gap-2">
                <button class="btn btn-success fw-semibold" (click)="openCheckoutDialog()">
                  <i class="bi bi-credit-card-2-front me-2"></i>
                  Proceed to Checkout
                </button>
                <button class="btn btn-danger fw-semibold" (click)="clearCart()">
                  <i class="bi bi-trash3 me-2"></i>
                  Clear Cart
                </button>
                <a href="/products" class="btn btn-outline-dark fw-semibold">
                  <i class="bi bi-arrow-left me-2"></i>
                  Continue Shopping
                </a>
              </div>

              <div class="row g-3 mt-4 pt-4 border-top text-center">
                <div class="col-4">
                  <i class="bi bi-shield-check text-warning fs-2 d-block mb-2"></i>
                  <span class="text-secondary small fw-semibold">Secure Payment</span>
                </div>
                <div class="col-4">
                  <i class="bi bi-truck text-warning fs-2 d-block mb-2"></i>
                  <span class="text-secondary small fw-semibold">Free Shipping</span>
                </div>
                <div class="col-4">
                  <i class="bi bi-arrow-clockwise text-warning fs-2 d-block mb-2"></i>
                  <span class="text-secondary small fw-semibold">Easy Returns</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  }
</div>