<div class="current-order-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner-container">
      <div class="custom-spinner"></div>
      <p>Loading your current order...</p>
    </div>
  </div>

  <!-- Error State -->
  <app-error-message *ngIf="error" [message]="error" (retryClick)="loadCurrentOrder()"></app-error-message>

  <div *ngIf="!loading && !error">
    <!-- Header -->
    

    <!-- Single Big Order Card -->
    <div *ngIf="currentOrder" class="order-big-card">
      <!-- Order Header -->
      <div class="order-header-section">
        <div class="order-info">
          <h4 class="order-title">
            <i class="bi bi-receipt me-2"></i>Order #{{ currentOrder.id }}
          </h4>
          <p class="order-date">
            <i class="bi bi-calendar-event me-1"></i>Placed on {{ currentOrder.placed_at | date:'MMM d, y' }}
          </p>
        </div>
        <div class="order-status">
          <span class="status-badge" [ngClass]="getStatusClass(currentOrder.status)">
            {{ getFormattedStatus(currentOrder.status) }}
          </span>
        </div>
      </div>

      <!-- Shipping Timeline -->
      <div *ngIf="currentOrder.status !== 'PENDING'" class="timeline-section">
        <app-shipping-timeline [timelineEvents]="timelineEvents"></app-shipping-timeline>
      </div>

      <!-- Main Content Layout -->
      <div class="order-main-content">
        <!-- Order Items Section (Left Side) -->
        <div class="order-items-section">
          <h5 class="section-title">
            <i class="bi bi-box-seam me-2"></i>Order Items ({{ currentOrder.orderItems.length }})
          </h5>
          <div class="items-list">
            <div class="item-card" *ngFor="let item of currentOrder.orderItems" (click)="navigateToProduct(item.productId)">
              <div class="item-image-container">
                <img [src]="getProductImage(item)"
                     [alt]="item.productName"
                     class="item-image">
              </div>
              <div class="item-content">
                <h6 class="item-name">{{ item.productName }}</h6>
                <div class="item-details">
                  <span class="quantity">
                    <i class="bi bi-dash-circle me-1"></i>Qty: {{ item.quantity }}
                  </span>
                  <span class="price">{{ item.price | currency:'INR':'symbol' }}</span>
                </div>
                <div class="item-total">
                  <span class="total-label">Subtotal:</span>
                  <span class="total-value">{{ (item.price * item.quantity) | currency:'INR':'symbol' }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Order Details Section (Right Side) -->
        <div class="order-details-section">
          <!-- Estimated Delivery Section -->
          <div class="detail-card delivery-section">
            <h6 class="detail-title">
              <i class="bi bi-calendar-check me-2"></i>Estimated Delivery
            </h6>
            <div class="detail-content">
              <div *ngIf="currentOrder.status === 'PENDING'" class="delivery-options">
                <div class="delivery-option" *ngFor="let option of deliveryOptions">
                  <input type="radio"
                         [id]="option.date"
                         [value]="option"
                         [(ngModel)]="selectedDeliveryDate"
                         name="deliveryDate">
                  <label [for]="option.date" class="delivery-label">
                    <span class="delivery-date">{{ option.date }}</span>
                    <span class="delivery-price" *ngIf="option.isFree">FREE</span>
                    <span class="delivery-price" *ngIf="!option.isFree">₹5.99</span>
                  </label>
                </div>
              </div>
              <div *ngIf="currentOrder.status !== 'PENDING'" class="delivery-info">
                <p class="delivery-date-display">{{ currentOrder.deliveryDate || getEstimatedDeliveryDate() }}</p>
              </div>
            </div>
          </div>

          <!-- Order Details Grid -->
          <div class="order-details-grid">
            <!-- Shipping Information -->
            <div class="detail-card">
              <h6 class="detail-title">
                <i class="bi bi-geo-alt me-2"></i>Shipping Address
              </h6>
              <div class="detail-content">
                <p class="detail-text" *ngIf="selectedAddress">{{ selectedAddress.address_line1 }}, {{ selectedAddress.city }}, {{ selectedAddress.state }} {{ selectedAddress.postal_code }}, {{ selectedAddress.country }}</p>
                <p class="detail-text" *ngIf="!selectedAddress">Loading address...</p>
              </div>
            </div>

            <!-- Payment Information -->
            <div class="detail-card">
              <h6 class="detail-title">
                <i class="bi bi-credit-card me-2"></i>Payment Method
              </h6>
              <div class="detail-content">
                <p class="detail-text" *ngIf="selectedPaymentMethod">{{ selectedPaymentMethod.cardType }} ending in {{ selectedPaymentMethod.lastFourDigits }}</p>
                <p class="detail-text" *ngIf="!selectedPaymentMethod">Loading payment method...</p>
                <p class="detail-text">Status: {{ currentOrder.status }}</p>
              </div>
            </div>

            <!-- Order Summary -->
            <div class="detail-card summary-card">
              <h6 class="detail-title">
                <i class="bi bi-receipt-cutoff me-2"></i>Order Summary
              </h6>
              <div class="summary-content">
                <div class="summary-row">
                  <span>Subtotal:</span>
                  <span class="summary-value">{{ currentOrder.totalAmount | currency:'INR':'symbol' }}</span>
                </div>
                <div class="summary-row">
                  <span>Shipping:</span>
                  <span class="summary-value free">FREE</span>
                </div>
                <div class="summary-row">
                  <span>Delivery:</span>
                  <span class="summary-value">{{ selectedDeliveryDate.isFree ? 'FREE' : '₹5.99' }}</span>
                </div>
                <div class="summary-row">
                  <span>Tax (9%):</span>
                  <span class="summary-value">{{ currentOrder.totalAmount * 0.09 | currency:'INR':'symbol' }}</span>
                </div>
                <hr class="summary-divider">
                <div class="summary-row total">
                  <span>Total:</span>
                  <span class="total-value">{{ (currentOrder.totalAmount * 1.09 + (selectedDeliveryDate.isFree ? 0 : 5.99)) | currency:'INR':'symbol' }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="order-actions">
            <button *ngIf="currentOrder.status === 'PENDING'" class="btn btn-payment" (click)="onMakePayment()">
              <i class="bi bi-credit-card-2-front me-2"></i>
              Proceed to Payment
            </button>
            <button *ngIf="currentOrder.status !== 'PENDING'" class="btn btn-support">
              <i class="bi bi-headset me-2"></i>
              Contact Support
            </button>
            <button class="btn btn-cancel" (click)="onCancelOrder()" *ngIf="currentOrder.status !== 'DELIVERED' && currentOrder.status !== 'COMPLETED' && currentOrder.status !== 'CANCELLED'">
              <i class="bi bi-x-circle me-2"></i>
              Cancel Order
            </button>
          </div>


        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!currentOrder" class="empty-state">
      <div class="empty-content">
        <i class="bi bi-bag-x empty-icon"></i>
        <h4>No Current Order</h4>
        <p>You don't have any pending orders at the moment. Start shopping to place an order!</p>
        <a href="/products" class="btn btn-primary">
          <i class="bi bi-shop me-2"></i>Browse Products
        </a>
      </div>
    </div>
  </div>
</div>
