<div class="order-history-container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3>
            <i class="bi bi-clock-history me-2"></i>Order History
        </h3>
    </div>

    <app-loader *ngIf="loading" [overlay]="true" message="Loading order history..."></app-loader>
    <app-error-message *ngIf="error" [message]="error" (retryClick)="loadOrders()"></app-error-message>

    <div *ngIf="!loading && !error">
        <!-- Orders Display - Collapsed by Default -->
        <div class="orders-grid">
            <div *ngFor="let order of allOrders" class="order-card">
                <!-- Collapsed View (Default) -->
                <div class="order-card-collapsed">
                    <div class="order-left">
                        <h5 class="order-number">Order #{{ order.id }}</h5>
                        <p class="order-date">Placed: {{ order.placed_at | date:'MMM d, y' }}</p>
                    </div>
                </div>

                <div class="order-card-footer">
                    <div class="order-total-left">
                        <strong>Total: {{ order.totalAmount | currency }}</strong>
                    </div>
                    <div class="order-actions-right">
                        <span class="status-badge" [ngClass]="getBadgeClass(order.status)">
                            {{ order.status }}
                        </span>
                        <button class="btn btn-primary btn-sm view-details-btn" (click)="toggleOrderDetails(order.id)">
                            {{ expandedOrderId === order.id ? 'Hide Details' : 'View Details' }}
                        </button>
                    </div>
                </div>

                <!-- Expanded Details View -->
                <div class="expanded-details" *ngIf="expandedOrderId === order.id">
                    <hr class="details-divider">
                    
                    <h6 class="items-title">Items in this Order ({{ order.orderItems.length }})</h6>
                    
                    <!-- Order Items -->
                    <div class="order-items-list">
                        <div class="history-item" *ngFor="let item of order.orderItems">
                            <div class="item-info">
                                <strong>Product:</strong> {{ item.productName }}<br>
                                <span class="text-muted">Quantity: {{ item.quantity }}</span><br>
                                <span class="text-muted">Total: {{ (item.price * item.quantity) | currency }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Shipping and Payment Info -->
                    <div class="order-meta-info">
                        <p><strong>Shipping Address ID:</strong> {{ order.addressId }}</p>
                        <p><strong>Payment Method ID:</strong> {{ order.paymentMethodId }}</p>
                    </div>
                </div>
            </div>

            <!-- Empty State -->
            <div *ngIf="allOrders.length === 0" class="empty-state">
                <i class="bi bi-inbox empty-icon"></i>
                <h4>No orders found</h4>
                <p>You don't have any orders at the moment.</p>
            </div>
        </div>
    </div>
</div>
